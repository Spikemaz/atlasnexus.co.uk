<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phase-1 UI Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #0f0; }
        button { background: #0f0; color: #000; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; font-weight: bold; }
        button:hover { background: #0a0; }
        .result { margin-top: 10px; padding: 10px; background: #000; border: 1px solid #333; white-space: pre-wrap; }
        .error { color: #f00; }
        .success { color: #0f0; }
        h2 { color: #0ff; }
        input, select { background: #333; color: #0f0; border: 1px solid #0f0; padding: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üöÄ Phase-1 UI Test Suite</h1>

    <div class="section">
        <h2>1Ô∏è‚É£ Login First</h2>
        <div>
            Username: <input type="text" id="username" value="admin">
            Password: <input type="password" id="password">
            <button onclick="doLogin()">Login</button>
        </div>
        <div>
            MFA Code: <input type="text" id="mfa" maxlength="6">
            <button onclick="doMFA()">Submit MFA</button>
        </div>
        <div id="authResult" class="result"></div>
    </div>

    <div class="section">
        <h2>2Ô∏è‚É£ Test Phase-1 Endpoints</h2>
        <button onclick="testHealth()">Health Check</button>
        <button onclick="testRouteList()">Route List</button>
        <button onclick="testProjectValidation()">Project Validation</button>
        <button onclick="testPermutations()">Run Permutations</button>
        <button onclick="testTop20()">Get Top-20</button>
        <button onclick="testCalc()">Single Calculator</button>
        <div id="testResult" class="result"></div>
    </div>

    <script>
        const API = 'https://atlasnexus.co.uk';

        function showResult(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.className = 'result ' + (isError ? 'error' : 'success');
            el.textContent = typeof message === 'object' ? JSON.stringify(message, null, 2) : message;
        }

        async function doLogin() {
            try {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                const response = await fetch(`${API}/auth/login`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: `username=${username}&password=${encodeURIComponent(password)}`
                });

                const result = await response.json();
                showResult('authResult', result, !result.success);
            } catch (e) {
                showResult('authResult', 'Login error: ' + e.message, true);
            }
        }

        async function doMFA() {
            try {
                const code = document.getElementById('mfa').value;

                const response = await fetch(`${API}/auth/mfa`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: `code=${code}`
                });

                const result = await response.json();
                showResult('authResult', result, !result.success);
            } catch (e) {
                showResult('authResult', 'MFA error: ' + e.message, true);
            }
        }

        async function testHealth() {
            try {
                const response = await fetch(`${API}/api/phase1/health`);
                const result = await response.json();
                showResult('testResult', result);
            } catch (e) {
                showResult('testResult', 'Health check error: ' + e.message, true);
            }
        }

        async function testRouteList() {
            try {
                const response = await fetch(`${API}/api/phase1/route-list`);
                const result = await response.json();
                showResult('testResult', result);
            } catch (e) {
                showResult('testResult', 'Route list error: ' + e.message, true);
            }
        }

        async function testProjectValidation() {
            try {
                const data = {
                    title: "London DC Alpha",
                    country: "UK",
                    currency: "GBP",
                    gross_it_load_mw: 75,
                    pue: 1.25,
                    lease_years: 25,
                    tenant_rating: "AA",
                    gross_monthly_rent: 2500000,
                    capex_cost_per_mw: 5400000
                };

                const response = await fetch(`${API}/api/phase1/projects/validate`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('testResult', result, !result.success);
            } catch (e) {
                showResult('testResult', 'Project validation error: ' + e.message, true);
            }
        }

        async function testPermutations() {
            try {
                const data = {
                    seed: 424242,
                    topn: 20,
                    ranges: {
                        senior_tenor: [10, 12, 15, 20],
                        senior_coupon: {min: 0.04, max: 0.06, step: 0.0025},
                        min_dscr_senior: {min: 1.25, max: 1.45, step: 0.05}
                    }
                };

                const response = await fetch(`${API}/api/phase1/run`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('testResult', result, !result.success);
            } catch (e) {
                showResult('testResult', 'Permutation error: ' + e.message, true);
            }
        }

        async function testTop20() {
            try {
                const response = await fetch(`${API}/api/phase1/securitisation/top20`, {
                    credentials: 'include'
                });

                const result = await response.json();
                showResult('testResult', result, !result.success);
            } catch (e) {
                showResult('testResult', 'Top-20 error: ' + e.message, true);
            }
        }

        async function testCalc() {
            try {
                const data = {
                    noi_monthly: 1950000,
                    funding_need: 415000000,
                    senior: {coupon_pct: 0.055, tenor_years: 15, min_dscr: 1.25}
                };

                const response = await fetch(`${API}/api/phase1/calc`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('testResult', result, !result.success);
            } catch (e) {
                showResult('testResult', 'Calc error: ' + e.message, true);
            }
        }
    </script>
</body>
</html>