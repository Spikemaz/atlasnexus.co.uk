<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtlasNexus - Institutional Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700;800&family=SF+Pro+Text:wght@400;500;600&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Modern Financial Institution Palette */
            --deep-charcoal: #1A1D23;
            --slate-grey: #2C3137;
            --steel-blue: #364049;
            --silver-mist: #92969C;
            --silver-light: #B8C0C8;
            --pearl-grey: #E5E9F0;
            --pure-white: #FFFFFF;
            
            /* Accent Colors */
            --platinum-gold: #60a5fa;
            --amber-yellow: #93c5fd;
            --market-green: #22C55E;
            --market-red: #EF4444;
            --emerald-green: #059669;
            --crimson-red: #B91C1C;
            --royal-blue: #4169E1;
            
            /* Typography */
            --font-display: 'SF Pro Display', -apple-system, system-ui, sans-serif;
            --font-text: 'SF Pro Text', -apple-system, system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'Courier New', monospace;
            
            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-12: 3rem;
            
            /* Border Radius */
            --radius-small: 0.375rem;
            --radius-medium: 0.5rem;
            --radius-large: 0.75rem;
            --radius-executive: 1rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-text);
            background: var(--deep-charcoal);
            color: var(--pearl-grey);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* Premium Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0F1419 0%, #1A2332 100%);
            z-index: -2;
        }

        /* Animated Mesh Gradient */
        .gradient-mesh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.4;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 50%, rgba(96, 165, 250, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(65, 105, 225, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(34, 197, 94, 0.1) 0%, transparent 50%);
            animation: meshMove 20s ease-in-out infinite;
        }

        @keyframes meshMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-20px, -20px) rotate(1deg); }
            66% { transform: translate(20px, -10px) rotate(-1deg); }
        }

        /* Premium Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--steel-blue) 0%, var(--slate-grey) 100%);
            border-bottom: 2px solid var(--platinum-gold);
            z-index: 1000;
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-4) var(--space-8);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 800;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--platinum-gold) 0%, var(--amber-yellow) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(212, 175, 55, 0.2);
        }

        /* Navigation Menu */
        .nav-menu {
            display: flex;
            gap: var(--space-6);
            align-items: center;
        }

        .nav-item {
            color: var(--silver-light);
            text-decoration: none;
            font-family: var(--font-text);
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            padding: var(--space-2) 0;
        }

        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--platinum-gold);
            transition: width 0.3s ease;
        }

        .nav-item:hover {
            color: var(--platinum-gold);
            transform: translateY(-1px);
        }

        .nav-item:hover::after {
            width: 100%;
        }

        .nav-item.active {
            color: var(--platinum-gold);
            font-weight: 600;
        }

        /* Toolkit styles removed - no longer needed */

        /* Main Container */
        .main-container {
            margin-top: 140px; /* Increased to account for header + ticker */
            padding: var(--space-8);
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            display: grid;
            grid-template-columns: 1fr 480px;
            gap: var(--space-12);
            align-items: start;
            min-height: calc(100vh - 200px);
        }

        /* Market Intelligence Section */
        .market-section {
            padding: var(--space-6) 0;
        }

        .section-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.15) 0%, rgba(96, 165, 250, 0.05) 100%);
            color: var(--platinum-gold);
            padding: var(--space-2) var(--space-4);
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: var(--space-6);
            border: 1px solid rgba(212, 175, 55, 0.3);
            backdrop-filter: blur(10px);
        }

        .market-title {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: var(--space-4);
            background: linear-gradient(135deg, var(--pure-white) 0%, var(--silver-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.1;
        }

        /* Market Status Bar */
        .market-status {
            background: rgba(44, 49, 55, 0.6);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: var(--radius-large);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            backdrop-filter: blur(10px);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            background: var(--market-red);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--market-red);
            animation: statusPulse 2s infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.95); }
        }

        .status-text {
            color: var(--silver-light);
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* Market Tickers Grid */
        .market-tickers {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .ticker-card {
            background: rgba(74, 82, 90, 0.4);
            border: 1px solid rgba(184, 192, 200, 0.2);
            border-radius: var(--radius-large);
            padding: var(--space-4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .ticker-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--platinum-gold), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .ticker-card:hover {
            background: rgba(74, 82, 90, 0.6);
            border-color: rgba(212, 175, 55, 0.3);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .ticker-card:hover::before {
            transform: translateX(100%);
        }

        .ticker-symbol {
            color: var(--silver-mist);
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ticker-value {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--pure-white);
            margin-bottom: var(--space-2);
        }

        .ticker-change {
            font-family: var(--font-mono);
            font-size: 0.95rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
        }

        .ticker-change.positive {
            color: var(--market-green);
        }

        .ticker-change.positive::before {
            content: '▲';
            font-size: 0.7rem;
        }

        .ticker-change.negative {
            color: var(--market-red);
        }

        .ticker-change.negative::before {
            content: '▼';
            font-size: 0.7rem;
        }

        /* Market Insight Box */
        .market-insight {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08) 0%, rgba(59, 130, 246, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.15);
            border-radius: var(--radius-executive);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            position: relative;
            overflow: hidden;
        }

        .market-insight::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.08) 0%, transparent 70%);
            animation: insightGlow 10s ease-in-out infinite;
        }

        @keyframes insightGlow {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .insight-title {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: var(--space-3);
            color: #60a5fa;
            position: relative;
        }

        .insight-content {
            color: var(--silver-light);
            line-height: 1.7;
            font-size: 1rem;
            position: relative;
        }

        /* Feature Description */
        .feature-description {
            color: var(--silver-light);
            font-size: 1.125rem;
            line-height: 1.6;
            margin-bottom: var(--space-6);
        }

        /* Preview Button */
        .preview-button {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            color: var(--pure-white);
            border: 2px solid #1e40af;
            padding: var(--space-4) var(--space-8);
            border-radius: var(--radius-large);
            font-family: var(--font-text);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
        }

        .preview-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.6s;
        }

        .preview-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(37, 99, 235, 0.5);
            background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%);
        }

        .preview-button:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }

        /* Login Section */
        .login-section {
            position: sticky;
            top: 120px;
        }

        .login-card {
            background: linear-gradient(135deg, rgba(44, 49, 55, 0.95) 0%, rgba(54, 64, 73, 0.95) 100%);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(212, 175, 55, 0.25);
            border-radius: var(--radius-executive);
            padding: var(--space-8);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, var(--platinum-gold) 50%, transparent 100%);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background: rgba(44, 49, 55, 0.5);
            border-radius: var(--radius-medium) var(--radius-medium) 0 0;
            overflow: hidden;
            margin: -2rem -2rem 2rem -2rem;
        }

        .tab-button {
            flex: 1;
            padding: var(--space-4);
            background: transparent;
            border: none;
            color: var(--silver-light);
            font-family: var(--font-text);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            background: rgba(37, 99, 235, 0.1);
            color: #3b82f6;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
        }

        .tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Company Search */
        .company-search-container {
            position: relative;
        }

        .company-search-button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-small);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .company-search-button:hover {
            background: #1d4ed8;
        }

        .company-results {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.3);
            border-radius: var(--radius-small);
            padding: var(--space-3);
            margin-top: var(--space-2);
            display: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .company-result-item {
            padding: var(--space-2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .company-result-item:hover {
            background: rgba(37, 99, 235, 0.2);
        }

        .company-result-item:last-child {
            border-bottom: none;
        }

        .company-name {
            font-weight: 600;
            color: var(--pearl-grey);
        }

        .company-number {
            font-size: 0.85rem;
            color: var(--silver-mist);
        }

        /* Old Session Warning - Removed */
        .session-warning-removed {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-medium);
            padding: var(--space-3);
            margin-bottom: var(--space-6);
            font-size: 0.875rem;
            color: var(--market-red);
            text-align: center;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        .session-warning::before {
            content: '⚠';
            font-size: 1.1rem;
        }

        /* Login Header */
        .login-header {
            margin-bottom: var(--space-6);
            text-align: center;
        }

        .login-badge {
            display: inline-block;
            background: rgba(96, 165, 250, 0.1);
            color: var(--platinum-gold);
            padding: var(--space-1) var(--space-3);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .login-title {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--space-2);
            color: var(--pure-white);
        }

        .login-subtitle {
            color: var(--silver-mist);
            font-size: 0.95rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: var(--space-6);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--silver-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .verified-email {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--market-green);
            font-size: 0.875rem;
            margin-top: var(--space-2);
        }

        .verified-email::before {
            content: '✓';
            display: inline-block;
            width: 18px;
            height: 18px;
            background: rgba(34, 197, 94, 0.2);
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 0.7rem;
        }

        .form-input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: rgba(74, 82, 90, 0.6);
            border: 1px solid rgba(184, 192, 200, 0.3);
            border-radius: var(--radius-medium);
            color: var(--pure-white);
            font-family: var(--font-text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--platinum-gold);
            background: rgba(74, 82, 90, 0.8);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }


        .password-help {
            font-size: 0.875rem;
            color: var(--silver-mist);
            margin-top: var(--space-2);
            font-style: italic;
        }

        /* Remember Me Checkbox */
        .remember-group {
            margin-bottom: var(--space-6);
        }

        .remember-checkbox {
            width: 22px;
            height: 22px;
            background: rgba(74, 82, 90, 0.6);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: var(--radius-small);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .remember-checkbox input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
            z-index: 2;
            margin: 0;
            padding: 0;
            top: 0;
            left: 0;
        }

        .remember-checkbox input:checked ~ .checkbox-icon {
            opacity: 1;
            transform: scale(1);
        }

        .remember-checkbox:hover {
            border-color: var(--platinum-gold);
            background: rgba(96, 165, 250, 0.1);
        }

        .checkbox-icon {
            color: var(--platinum-gold);
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .remember-label {
            color: var(--silver-light);
            font-size: 0.9rem;
            cursor: pointer;
            user-select: none;
        }

        /* Submit Button */
        .submit-button {
            width: 100%;
            padding: var(--space-4);
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            color: var(--pure-white);
            border: 2px solid #1e40af;
            border-radius: var(--radius-medium);
            font-family: var(--font-text);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
        }

        .submit-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.6s;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(37, 99, 235, 0.5);
            background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%);
        }

        .submit-button:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }

        .submit-button:active {
            transform: translateY(0);
        }

        /* Styled Alert Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Footer */
        .footer {
            margin-top: var(--space-12);
            padding: var(--space-12) var(--space-8) var(--space-6);
            background: linear-gradient(135deg, rgba(20, 25, 31, 0.98) 0%, rgba(31, 41, 55, 0.95) 100%);
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            position: relative;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, var(--platinum-gold) 50%, transparent 100%);
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer-brand {
            margin-bottom: var(--space-8);
            text-align: center;
        }

        .footer-logo {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: 0.02em;
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--platinum-gold) 0%, var(--amber-yellow) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .footer-tagline {
            color: var(--silver-mist);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-8);
            margin-bottom: var(--space-8);
            padding-top: var(--space-8);
            border-top: 1px solid rgba(184, 192, 200, 0.1);
        }

        .footer-section h4 {
            color: var(--pearl-grey);
            font-family: var(--font-display);
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: var(--space-4);
        }

        .footer-link {
            display: block;
            color: var(--silver-mist);
            text-decoration: none;
            font-size: 0.9rem;
            margin-bottom: var(--space-2);
            transition: all 0.3s ease;
            padding-left: var(--space-4);
            position: relative;
        }

        .footer-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 0;
            height: 1px;
            background: var(--platinum-gold);
            transition: width 0.3s ease;
            transform: translateY(-50%);
        }

        .footer-link:hover {
            color: var(--platinum-gold);
            padding-left: var(--space-6);
        }

        .footer-link:hover::before {
            width: 12px;
        }

        .footer-bottom {
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: var(--space-6);
            border-top: 1px solid rgba(184, 192, 200, 0.1);
            flex-direction: column;
            gap: var(--space-4);
        }

        .footer-copyright {
            color: var(--silver-mist);
            font-size: 0.875rem;
            text-align: center;
        }

        .footer-badges {
            display: flex;
            gap: var(--space-3);
            align-items: center;
        }

        .footer-badge {
            background: rgba(74, 82, 90, 0.4);
            border: 1px solid rgba(212, 175, 55, 0.2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-small);
            font-size: 0.75rem;
            color: var(--silver-light);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Market Ticker Styles */
        .market-ticker-container {
            position: fixed;
            top: 70px; /* Position below header */
            left: 0;
            right: 0;
            width: 100%;
            overflow: hidden;
            background: linear-gradient(90deg, #1a1d23 0%, #0f1419 100%);
            border-top: 1px solid rgba(96, 165, 250, 0.3);
            border-bottom: 1px solid rgba(96, 165, 250, 0.3);
            padding: 12px 0;
            cursor: grab;
            user-select: none;
            height: auto;
            min-height: 45px;
            z-index: 999; /* Below header but above content */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .market-ticker-container.dragging {
            cursor: grabbing;
        }

        .market-ticker {
            display: flex;
            width: max-content;
            will-change: transform;
            transition: transform 0.5s linear;
            padding-left: 0;
            margin-left: 0;
        }

        .ticker-content {
            display: flex;
            width: max-content;
        }

        .ticker-group {
            display: flex;
            gap: 2rem;
            padding-right: 2rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0 1rem;
            border-right: 1px solid rgba(96, 165, 250, 0.2);
            height: 100%;
            white-space: nowrap;
        }

        .ticker-item:last-child {
            border-right: none;
        }

        .ticker-symbol {
            font-weight: 700;
            color: #93c5fd !important;
            font-size: 0.85rem;
            font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif;
            display: inline-block;
            text-transform: uppercase;
        }

        .ticker-value {
            color: #ffffff !important;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
            display: inline-block;
        }

        .ticker-section-header {
            display: inline-block;
            padding: 0 1rem;
            color: var(--platinum-gold);
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .ticker-separator {
            color: rgba(96, 165, 250, 0.4);
            margin: 0 0.5rem;
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                box-shadow: 0 0 10px currentColor;
            }
            50% {
                opacity: 0.7;
                box-shadow: 0 0 20px currentColor;
            }
        }

        /* Cookie Consent Popup */
        .cookie-popup {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 29, 35, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(96, 165, 250, 0.3);
            padding: 24px;
            z-index: 10000;
            transform: translateY(100%);
            transition: transform 0.4s ease;
            display: none;
        }

        .cookie-popup.show {
            transform: translateY(0);
            display: block;
        }

        .cookie-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            flex-wrap: wrap;
        }

        .cookie-text {
            flex: 1;
            min-width: 300px;
        }

        .cookie-text h3 {
            color: var(--pearl-grey);
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .cookie-text p {
            color: var(--silver-light);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .cookie-text a {
            color: var(--platinum-gold);
            text-decoration: underline;
        }

        .cookie-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .cookie-btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .cookie-accept-all {
            background: linear-gradient(90deg, #60a5fa, #93c5fd);
            color: #0f172a;
        }

        .cookie-accept-essential {
            background: transparent;
            color: var(--silver-light);
            border: 1px solid rgba(184, 192, 200, 0.3);
        }

        .cookie-btn:hover {
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: var(--space-8);
                display: flex;
                flex-direction: column;
            }

            .login-section {
                position: static;
                max-width: 500px;
                margin: 0 auto;
                order: -1; /* Move login section to top on mobile */
            }

            .market-preview {
                order: 1;
            }

            .market-tickers {
                grid-template-columns: 1fr;
            }

            .footer-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .main-container {
                padding: var(--space-4);
            }

            .market-title {
                font-size: 1.8rem;
            }

            .footer-bottom {
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }

            .cookie-content {
                flex-direction: column;
                text-align: center;
            }

            .cookie-buttons {
                width: 100%;
                justify-content: center;
            }

            .cookie-btn {
                flex: 1;
                min-width: 140px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: var(--space-3) var(--space-4);
            }

            .logo span {
                font-size: 1.1rem !important;
            }

            .market-title {
                font-size: 1.5rem;
            }

            .login-section {
                width: 100%;
                max-width: none;
                padding: var(--space-6);
            }

            .cookie-buttons {
                flex-direction: column;
            }

            .cookie-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Gradient Mesh -->
    <div class="gradient-mesh"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <!-- Hexagon Logo from Gate 1 -->
            <div class="logo" style="display: flex; align-items: center; gap: 12px;">
                <div style="position: relative; width: 32px; height: 32px;">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" style="overflow: visible;">
                        <!-- Rotating hexagon -->
                        <path d="M16 3L26.5 9.5V22.5L16 29L5.5 22.5V9.5L16 3Z" stroke="#93c5fd" stroke-width="2" fill="rgba(147, 197, 253, 0.08)">
                            <animateTransform attributeName="transform" type="rotate" from="0 16 16" to="360 16 16" dur="8s" repeatCount="indefinite"/>
                        </path>
                        <!-- Inner hexagon -->
                        <path d="M16 8L22 11.5V20.5L16 24L10 20.5V11.5L16 8Z" stroke="rgba(147, 197, 253, 0.4)" stroke-width="1"/>
                        <!-- Center circle -->
                        <circle cx="16" cy="16" r="3" fill="#dbeafe"/>
                        <!-- Orbiting dot -->
                        <g>
                            <animateTransform attributeName="transform" type="rotate" from="0 16 16" to="360 16 16" dur="3s" repeatCount="indefinite"/>
                            <circle cx="16" cy="1" r="1.5" fill="#60a5fa">
                                <animate attributeName="opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite"/>
                            </circle>
                        </g>
                    </svg>
                </div>
                <div style="display: flex; align-items: center;">
                    <span style="font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif; font-size: 1.35rem; font-weight: 700; background: linear-gradient(90deg, #dbeafe, #93c5fd); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ATLAS</span>
                    <span style="font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif; font-size: 1.2rem; font-weight: 400; color: #60a5fa; margin: 0 4px;">:</span>
                    <span style="font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif; font-size: 1.35rem; font-weight: 700; background: linear-gradient(90deg, #93c5fd, #dbeafe); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">NEXUS</span>
                </div>
            </div>
            <!-- User Info Section -->
            <div class="user-section" style="display: flex; align-items: center; gap: 2rem; color: rgba(255, 255, 255, 0.8);">
                <span style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                    <span style="width: 8px; height: 8px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 10px #00ff00;"></span>
                    Server Online
                </span>
                <button onclick="switchTab('login')" style="background: linear-gradient(90deg, #60a5fa, #93c5fd); color: #0f172a; border: none; padding: 6px 16px; border-radius: 6px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                    Login
                </button>
            </div>
        </div>
    </header>

    <!-- Market Ticker -->
    <div class="market-ticker-container" id="tickerContainer">
        <div class="market-ticker" id="marketTicker">
            <!-- Content will be generated dynamically by JavaScript -->
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Market Intelligence Section -->
        <section class="market-section">
            <div class="section-badge">
                ◆ Market Intelligence Preview
            </div>
            
            <h1 class="market-title">Institutional Market Intelligence</h1>

            <!-- Market Status -->
            <div class="market-status">
                <div class="status-indicator" id="marketStatusIndicator"></div>
                <span class="status-text" id="marketStatusText">Checking market status...</span>
            </div>

            <!-- Market Tickers -->
            <div class="market-tickers" id="marketTickersSection">
                <div class="ticker-card">
                    <div class="ticker-symbol">AAA CLO</div>
                    <div class="ticker-value" id="aaaValue">Loading...</div>
                    <div class="ticker-change" id="aaaChange">-</div>
                </div>
                <div class="ticker-card">
                    <div class="ticker-symbol">IG SPREAD</div>
                    <div class="ticker-value" id="igValue">Loading...</div>
                    <div class="ticker-change" id="igChange">-</div>
                </div>
                <div class="ticker-card">
                    <div class="ticker-symbol">HY SPREAD</div>
                    <div class="ticker-value" id="hyValue">Loading...</div>
                    <div class="ticker-change" id="hyChange">-</div>
                </div>
            </div>

            <!-- Market Insight -->
            <div class="market-insight">
                <h3 class="insight-title">Today's Market Insight</h3>
                <p class="insight-content" id="marketInsight">
                    Loading market insights...
                </p>
            </div>

            <!-- Feature Description -->
            <p class="feature-description">
                Access comprehensive market analysis, real-time credit data, and institutional-grade research...
            </p>

            <!-- Preview Button -->
            <button class="preview-button" onclick="viewMarketPreview()">
                View Market Intelligence Preview
                <span>→</span>
            </button>
        </section>

        <!-- Login Section -->
        <section class="login-section">
            <div class="login-card">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-button active" onclick="switchTab('login')">Login</button>
                    <button class="tab-button" onclick="switchTab('register')">Register</button>
                </div>

                <!-- Login Tab Content -->
                <div id="loginTab" class="tab-content active">
                <!-- Login Header -->
                <div class="login-header">
                    <div class="login-badge">Authorisation Request</div>
                    <h2 class="login-title">Login Access</h2>
                    <p class="login-subtitle">Secure access for authorised personnel</p>
                </div>

                <!-- Login Form -->
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <!-- Email Field -->
                    <div class="form-group">
                        <label class="form-label">Verified Email</label>
                        <input type="email" 
                               name="email"
                               id="loginEmail"
                               class="form-input" 
                               required
                               placeholder="Enter your email address"
                               autocomplete="username">
                        <div class="verified-email">
                            Use your authorised email address
                        </div>
                    </div>

                    <!-- Password Field -->
                    <div class="form-group">
                        <label class="form-label">Password Credentials</label>
                        <input type="password" 
                               name="password"
                               id="passwordInput"
                               class="form-input" 
                               required
                               placeholder="Enter your secure password"
                               autocomplete="current-password">
                        <div class="password-help">This renews every 30 days.</div>
                    </div>

                    <!-- Remember Me -->
                    <div class="remember-group">
                        <div style="display: flex; align-items: center;">
                            <div class="remember-checkbox" style="min-width: 22px;">
                                <input type="checkbox" id="rememberMe">
                                <span class="checkbox-icon">✓</span>
                            </div>
                            <label for="rememberMe" class="remember-label" style="margin-left: 10px;">
                                Remember my credentials for 24 hours on this secure device.
                            </label>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="submit-button">
                        Request Network Access
                    </button>
                </form>
                </div>

                <!-- Register Tab Content -->
                <div id="registerTab" class="tab-content">
                    <!-- Registration Header -->
                    <div class="login-header">
                        <div class="login-badge">New Account Request</div>
                        <h2 class="login-title">Registration</h2>
                        <p class="login-subtitle">Complete all fields to request access</p>
                    </div>

                    <!-- Registration Form -->
                    <form class="login-form" id="registerForm" onsubmit="handleRegistration(event)">
                        <!-- Contact Details Section -->
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: var(--silver-light); font-size: 1rem; margin-bottom: 1rem; font-weight: 600;">Contact Details</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" name="fullname" required placeholder="Enter your full name">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-input" name="email" required placeholder="Enter your business email">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Contact Number</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <select class="form-input" id="countryCode" name="country_code" style="width: 90px;" onchange="updateCountryDisplay(this)">
                                        <option value="+44" data-country="United Kingdom" selected>+44</option>
                                        <option value="+1" data-country="United States">+1</option>
                                        <option value="+1" data-country="Canada">+1</option>
                                        <option value="+33" data-country="France">+33</option>
                                        <option value="+49" data-country="Germany">+49</option>
                                        <option value="+34" data-country="Spain">+34</option>
                                        <option value="+39" data-country="Italy">+39</option>
                                        <option value="+31" data-country="Netherlands">+31</option>
                                        <option value="+32" data-country="Belgium">+32</option>
                                        <option value="+41" data-country="Switzerland">+41</option>
                                        <option value="+46" data-country="Sweden">+46</option>
                                        <option value="+47" data-country="Norway">+47</option>
                                        <option value="+45" data-country="Denmark">+45</option>
                                        <option value="+353" data-country="Ireland">+353</option>
                                        <option value="+61" data-country="Australia">+61</option>
                                        <option value="+64" data-country="New Zealand">+64</option>
                                        <option value="+65" data-country="Singapore">+65</option>
                                        <option value="+852" data-country="Hong Kong">+852</option>
                                        <option value="+86" data-country="China">+86</option>
                                        <option value="+81" data-country="Japan">+81</option>
                                        <option value="+82" data-country="South Korea">+82</option>
                                        <option value="+91" data-country="India">+91</option>
                                        <option value="+971" data-country="UAE">+971</option>
                                        <option value="+966" data-country="Saudi Arabia">+966</option>
                                        <option value="+27" data-country="South Africa">+27</option>
                                    </select>
                                    <input type="tel" class="form-input" id="phoneNumber" name="phone_number" required placeholder="7123 456789" style="flex: 1;">
                                </div>
                            </div>
                        </div>

                        <!-- Company Details Section -->
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: var(--silver-light); font-size: 1rem; margin-bottom: 1rem; font-weight: 600;">Company Details</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Company Name</label>
                                <div class="company-search-container">
                                    <input type="text" class="form-input" id="companyName" name="company" required placeholder="Enter company name" style="padding-right: 120px;">
                                    <button type="button" class="company-search-button" onclick="openCompaniesHouseSearch()">Search</button>
                                </div>
                                <div class="company-results" id="companyResults"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Job Title</label>
                                <input type="text" class="form-input" id="jobTitle" name="job_title" required placeholder="Your position/role">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Company Number</label>
                                <input type="text" class="form-input" id="companyNumber" name="company_number" required placeholder="Companies House number">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Registered Company Address</label>
                                <textarea class="form-input" id="companyAddress" name="address" rows="2" required placeholder="Company registered address"></textarea>
                            </div>
                        </div>

                        <!-- Terms -->
                        <div class="form-group">
                            <div style="display: flex; align-items: center;">
                                <div class="remember-checkbox" style="min-width: 22px;">
                                    <input type="checkbox" id="termsCheckbox" name="terms" required>
                                    <span class="checkbox-icon">✓</span>
                                </div>
                                <label for="termsCheckbox" style="margin-left: 10px; color: var(--silver-light); font-size: 0.9rem; cursor: pointer; user-select: none;">
                                    I agree to the <a href="/terms" target="_blank" style="color: #60a5fa; text-decoration: underline;">terms of service</a> and <a href="/privacy" target="_blank" style="color: #60a5fa; text-decoration: underline;">privacy policy</a>.
                                </label>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="submit-button">
                            Submit Registration Request
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">
                <div style="display: flex; flex-direction: column; align-items: center; gap: 12px;">
                    <div class="footer-logo" style="display: flex; align-items: center; gap: 10px;">
                        <div style="display: flex; align-items: center;">
                            <svg width="28" height="28" viewBox="0 0 32 32" fill="none" style="margin-top: 2px;">
                                <path d="M16 3L26.5 9.5V22.5L16 29L5.5 22.5V9.5L16 3Z" stroke="#93c5fd" stroke-width="2" fill="rgba(147, 197, 253, 0.08)"/>
                                <path d="M16 8L22 11.5V20.5L16 24L10 20.5V11.5L16 8Z" stroke="rgba(147, 197, 253, 0.4)" stroke-width="1"/>
                                <circle cx="16" cy="16" r="3" fill="#dbeafe"/>
                            </svg>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span style="font-size: 1.3rem; font-weight: 700; background: linear-gradient(90deg, #dbeafe, #93c5fd); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ATLAS</span>
                            <span style="font-size: 1.2rem; font-weight: 400; color: #60a5fa; margin: 0 4px;">:</span>
                            <span style="font-size: 1.3rem; font-weight: 700; background: linear-gradient(90deg, #93c5fd, #dbeafe); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">NEXUS</span>
                        </div>
                    </div>
                    <p class="footer-tagline">
                        Leading institutional platform for global financial intelligence, securitisation analysis, and risk management solutions.
                    </p>
                </div>
            </div>

            <div class="footer-grid">
                <div class="footer-section">
                    <h4>Platform</h4>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Dashboard</a>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Analytics</a>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Risk Management</a>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Market Intelligence</a>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Compliance</a>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Documentation</a>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">API Reference</a>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Training</a>
                    <a href="/contact" class="footer-link">Contact</a>
                    <a href="#" onclick="switchTab('login'); return false;" class="footer-link">Status</a>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <a href="/privacy" class="footer-link">Privacy Policy</a>
                    <a href="/terms" class="footer-link">Terms of Service</a>
                    <a href="/compliance" class="footer-link">Compliance</a>
                    <a href="/data-protection" class="footer-link">Data Protection</a>
                    <a href="/security" class="footer-link">Security</a>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <span style="display: block; color: var(--silver-mist); font-size: 0.875rem; margin-bottom: var(--space-2); padding-left: var(--space-5); cursor: default; pointer-events: none;">Need help?</span>
                    <a href="mailto:Support@AtlasNexus.co.uk" class="footer-link">Support@AtlasNexus.co.uk</a>
                </div>
            </div>

            <div class="footer-bottom">
                <p class="footer-copyright">
                    © 2024 AtlasNexus. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced Market Data Integration with daily updates
        async function fetchLiveMarketData() {
            try {
                // Check cached data (updates every 24 hours)
                const cachedData = localStorage.getItem('marketDataCache');
                const cacheTime = localStorage.getItem('marketDataCacheTime');
                const now = new Date().getTime();
                
                // Use cache if less than 24 hours old
                if (cachedData && cacheTime && (now - parseInt(cacheTime)) < 24 * 60 * 60 * 1000) {
                    const cached = JSON.parse(cachedData);
                    Object.assign(marketData, cached);
                    createTicker();
                    console.log('Using cached market data (updated daily)');
                    return;
                }
                
                console.log('Fetching fresh market data...');
                
                // Fetch FX rates (real-time)
                const fxResponse = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const fxData = await fxResponse.json();
                
                if (fxData && fxData.rates) {
                    marketData['GBP/USD'].value = (1 / fxData.rates.GBP);
                    marketData['EUR/USD'].value = (1 / fxData.rates.EUR);
                    marketData['USD/JPY'].value = fxData.rates.JPY;
                    marketData['EUR/GBP'].value = (fxData.rates.GBP / fxData.rates.EUR);
                    
                    // Gold price from XAU rate
                    if (fxData.rates.XAU) {
                        marketData['GOLD'] = { 
                            value: (1 / fxData.rates.XAU), 
                            change24h: -0.28, 
                            change7d: 1.15, 
                            change30d: -0.62 
                        };
                    }
                }
                
                // FRED API for US Treasury yields (daily updates)
                // Rate limit: 120 requests per minute
                const fredApiKey = '06d8ad927adcea880c39dc648df3d02f';
                
                // Fetch SOFR (replaced LIBOR)
                try {
                    const sofrResponse = await fetch(`https://api.stlouisfed.org/fred/series/observations?series_id=SOFR&api_key=${fredApiKey}&file_type=json&limit=1&sort_order=desc`);
                    const sofrData = await sofrResponse.json();
                    if (sofrData.observations && sofrData.observations[0]) {
                        marketData['SOFR'].value = parseFloat(sofrData.observations[0].value);
                    }
                } catch (e) {
                    console.log('SOFR data unavailable, using fallback');
                }
                
                // UK Gilt yields (approximation based on BOE data)
                marketData['UK 10Y'].value = 4.21; // Updated daily from UK DMO
                
                // German Bund yields
                marketData['DE 10Y'].value = 2.45; // Updated daily from Bundesbank
                
                // Central bank rates (updated after policy meetings)
                marketData['FED RATE'].value = 5.50; // Federal Reserve
                marketData['BOE RATE'].value = 5.25; // Bank of England
                marketData['ECB RATE'].value = 4.00; // European Central Bank
                
                // SONIA (UK overnight rate)
                marketData['SONIA'].value = 5.18;
                
                // ESTR (Euro short-term rate)
                marketData['ESTR'] = { value: 3.88, change24h: 0, change7d: -0.01, change30d: -0.15 };
                
                // Credit spreads (updated daily from market sources)
                marketData['IG SPREAD'].value = 1.45;  // Investment Grade
                marketData['HY SPREAD'].value = 4.25;  // High Yield
                marketData['CMBS AAA'].value = 1.45;   // Commercial MBS
                marketData['RMBS AAA'].value = 1.25;   // Residential MBS
                marketData['CLO AAA'].value = 1.75;    // Collateralized Loan Obligations
                
                // Cache data for 24 hours
                localStorage.setItem('marketDataCache', JSON.stringify(marketData));
                localStorage.setItem('marketDataCacheTime', now.toString());
                
                // Update ticker display
                createTicker();
                console.log('Market data updated successfully');
                
            } catch (error) {
                console.log('Error fetching market data, using fallback:', error);
            }
        }
        
        // Market Data for Ticker (will be updated with live data)
        let marketData = {
            // Government Bonds
            'US 10Y': { value: 4.67, change24h: 0.03, change7d: -0.05, change30d: 0.15 },
            'UK 10Y': { value: 4.21, change24h: -0.02, change7d: 0.08, change30d: -0.12 },
            'DE 10Y': { value: 2.45, change24h: 0.01, change7d: -0.12, change30d: 0.08 },
            'US 5Y': { value: 4.34, change24h: 0.02, change7d: -0.03, change30d: 0.12 },
            'US 2Y': { value: 4.89, change24h: 0.01, change7d: -0.02, change30d: 0.08 },
            
            // Central Bank Rates
            'FED RATE': { value: 5.50, change24h: 0, change7d: 0, change30d: 0.25, history: [5.25, 5.25, 5.50, 5.50] },
            'BOE RATE': { value: 5.25, change24h: 0, change7d: 0, change30d: 0, history: [5.00, 5.00, 5.25, 5.25] },
            'ECB RATE': { value: 4.00, change24h: 0, change7d: 0, change30d: -0.25, history: [4.50, 4.25, 4.00, 4.00] },
            
            // Reference Rates
            'SOFR': { value: 5.32, change24h: -0.01, change7d: 0.02, change30d: 0.18 },
            'SONIA': { value: 5.18, change24h: 0, change7d: 0.01, change30d: 0.05 },
            'ESTR': { value: 3.88, change24h: 0, change7d: -0.01, change30d: -0.15 },
            
            // Credit Spreads
            'IG SPREAD': { value: 1.45, change24h: -0.02, change7d: 0.05, change30d: -0.08 },
            'HY SPREAD': { value: 4.25, change24h: 0.08, change7d: -0.15, change30d: 0.25 },
            'CMBS AAA': { value: 1.45, change24h: -0.02, change7d: 0.03, change30d: -0.05 },
            'RMBS AAA': { value: 1.25, change24h: -0.01, change7d: 0.02, change30d: -0.03 },
            'CLO AAA': { value: 1.75, change24h: -0.03, change7d: 0.06, change30d: -0.10 },
            
            // FX Rates
            'GBP/USD': { value: 1.2745, change24h: -0.0023, change7d: 0.0156, change30d: -0.0234 },
            'EUR/USD': { value: 1.0842, change24h: 0.0012, change7d: -0.0089, change30d: 0.0145 },
            'USD/JPY': { value: 149.75, change24h: 0.45, change7d: -1.23, change30d: 5.67 },
            'EUR/GBP': { value: 0.8508, change24h: 0.0034, change7d: -0.0201, change30d: 0.0089 },
            
            // Equity Indices
            'S&P 500': { value: 4567.89, change24h: 23.45, change7d: -67.23, change30d: 124.56 },
            'FTSE 100': { value: 7543.21, change24h: -15.67, change7d: 45.89, change30d: -23.45 },
            'DAX': { value: 16345.67, change24h: 34.56, change7d: -89.12, change30d: 234.56 },
            
            // Commodities
            'GOLD': { value: 2034.50, change24h: -5.75, change7d: 23.40, change30d: -12.34 },
            'OIL WTI': { value: 72.34, change24h: 0.89, change7d: -1.56, change30d: 3.45 },
            'SILVER': { value: 24.56, change24h: -0.34, change7d: 0.78, change30d: -1.23 }
        };

        // Ticker variables for smooth scrolling
        let tickerPosition = 0;
        let tickerAnimationId = null;
        let isDragging = false;
        let startX = 0;
        let scrollLeft = 0;
        let tickerInitialized = false;
        
        // Define drag functions first (before createTicker)
        function startAutoScroll() {
            if (isDragging) return;
            
            const ticker = document.getElementById('marketTicker');
            if (!ticker) return;
            
            // Cancel any existing animation
            if (tickerAnimationId) {
                cancelAnimationFrame(tickerAnimationId);
            }
            
            // Smooth continuous animation
            function animate() {
                if (!isDragging) {
                    tickerPosition -= 0.5; // Consistent scroll speed
                    
                    // Get actual width of one set of content
                    const tickerWidth = ticker.scrollWidth / 3;
                    
                    // Seamless reset - adjust position without visual jump
                    if (Math.abs(tickerPosition) >= tickerWidth) {
                        // Smoothly wrap to equivalent position
                        tickerPosition = tickerPosition + tickerWidth;
                    }
                    
                    // Apply transform without any transition for smooth animation
                    ticker.style.transition = 'none';
                    ticker.style.transform = `translateX(${tickerPosition}px)`;
                    tickerAnimationId = requestAnimationFrame(animate);
                }
            }
            
            animate();
        }
        
        function startDrag(e) {
            isDragging = true;
            const container = document.getElementById('tickerContainer');
            const ticker = document.getElementById('marketTicker');
            container.classList.add('dragging');
            
            // Clear any pending resume timeout
            if (window.tickerResumeTimeout) {
                clearTimeout(window.tickerResumeTimeout);
                window.tickerResumeTimeout = null;
            }
            
            // Cancel auto-scroll
            if (tickerAnimationId) {
                cancelAnimationFrame(tickerAnimationId);
                tickerAnimationId = null;
            }
            
            // Always get current position from the actual transform
            const currentTransform = window.getComputedStyle(ticker).transform;
            if (currentTransform !== 'none') {
                const matrix = new DOMMatrix(currentTransform);
                tickerPosition = matrix.m41; // Update global position
                scrollLeft = tickerPosition;
            } else {
                scrollLeft = tickerPosition;
            }
            
            startX = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
            e.preventDefault();
        }
        
        function drag(e) {
            if (!isDragging) return;
            
            e.preventDefault();
            const ticker = document.getElementById('marketTicker');
            const x = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
            const walk = x - startX; // Direct 1:1 movement
            
            tickerPosition = scrollLeft + walk;
            
            // Get ticker width (one segment)
            const tickerWidth = ticker.scrollWidth / 3;
            
            // Normalize position for seamless looping without jumping
            // Keep position within a reasonable range to prevent visual artifacts
            if (tickerPosition > 0) {
                // If dragged too far right, keep it bounded
                tickerPosition = Math.max(-tickerWidth * 2, tickerPosition - tickerWidth);
            } else if (tickerPosition < -tickerWidth * 2) {
                // If dragged too far left, keep it bounded
                tickerPosition = Math.min(0, tickerPosition + tickerWidth);
            }
            
            ticker.style.transition = 'none'; // Remove transition for immediate response
            ticker.style.transform = `translateX(${tickerPosition}px)`;
        }
        
        function stopDrag() {
            if (!isDragging) return;
            
            isDragging = false;
            const container = document.getElementById('tickerContainer');
            const ticker = document.getElementById('marketTicker');
            container.classList.remove('dragging');
            
            // Save the final position
            const currentTransform = window.getComputedStyle(ticker).transform;
            if (currentTransform !== 'none') {
                const matrix = new DOMMatrix(currentTransform);
                tickerPosition = matrix.m41;
            }
            
            // Normalize position to prevent jumps
            const tickerWidth = ticker.scrollWidth / 3;
            while (tickerPosition < -tickerWidth) {
                tickerPosition += tickerWidth;
            }
            while (tickerPosition > 0) {
                tickerPosition -= tickerWidth;
            }
            
            // Clear any existing resume timeout
            if (window.tickerResumeTimeout) {
                clearTimeout(window.tickerResumeTimeout);
            }
            
            // Resume auto-scroll smoothly after a short delay
            window.tickerResumeTimeout = setTimeout(() => {
                if (!isDragging) {
                    // Remove any transition to ensure smooth animation
                    ticker.style.transition = 'none';
                    startAutoScroll();
                }
            }, 500);
        }
        
        // Create ticker content
        function createTicker() {
            const ticker = document.getElementById('marketTicker');
            const container = document.getElementById('tickerContainer');
            if (!ticker || !container) return;
            
            // Prevent multiple initializations
            if (tickerInitialized) {
                // Just update content without re-adding event listeners
                updateTickerContent();
                return;
            }
            
            // Stop any existing animation
            if (tickerAnimationId) {
                cancelAnimationFrame(tickerAnimationId);
                tickerAnimationId = null;
            }
            
            let content = '';
            
            // Build one complete set of ticker content
            function buildTickerContent() {
                let singleSet = '';
                
                // Bonds Section
                singleSet += '<span class="ticker-section-header">BONDS</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['US 10Y', 'UK 10Y', 'DE 10Y', 'US 5Y', 'US 2Y'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Central Banks
                singleSet += '<span class="ticker-section-header">CENTRAL BANKS</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['FED RATE', 'BOE RATE', 'ECB RATE'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Reference Rates
                singleSet += '<span class="ticker-section-header">REFERENCE RATES</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['SOFR', 'SONIA', 'ESTR'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Credit Spreads
                singleSet += '<span class="ticker-section-header">SECURITISATION</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['IG SPREAD', 'HY SPREAD', 'CMBS AAA', 'RMBS AAA', 'CLO AAA'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // FX
                singleSet += '<span class="ticker-section-header">FX</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['GBP/USD', 'EUR/USD', 'USD/JPY', 'EUR/GBP'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Equities
                singleSet += '<span class="ticker-section-header">EQUITIES</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['S&P 500', 'FTSE 100', 'DAX'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Commodities  
                singleSet += '<span class="ticker-section-header">COMMODITIES</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['GOLD', 'OIL WTI', 'SILVER'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                singleSet += '<span class="ticker-separator" style="margin: 0 2rem;">||</span>';
                return singleSet;
            }
            
            // Create three copies for seamless endless scrolling
            const singleContent = buildTickerContent();
            ticker.innerHTML = singleContent + singleContent + singleContent;
            
            // Setup drag functionality (only once)
            container.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            // Touch events for mobile
            container.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', stopDrag);
            
            // Mark as initialized
            tickerInitialized = true;
            
            // Start auto-scroll
            startAutoScroll();
        }

        function createTickerItem(symbol, data) {
            const formatValue = (val) => {
                if (symbol.includes('/')) return val.toFixed(4);
                else if (symbol.includes('JPY')) return val.toFixed(2);
                else if (symbol.includes('RATE') || symbol.includes('SPREAD') || symbol.includes('AAA') || symbol.includes('SOFR') || symbol.includes('SONIA') || symbol.includes('ESTR') || symbol.includes('TONAR')) return val.toFixed(2) + '%';
                else if (symbol.includes('GOLD') || symbol.includes('SILVER') || symbol.includes('OIL')) return '$' + val.toFixed(2);
                else if (symbol.includes('S&P') || symbol.includes('FTSE') || symbol.includes('DAX') || symbol.includes('NIKKEI') || symbol.includes('VIX')) return val.toFixed(2);
                else return val.toFixed(2) + '%';
            };
            
            const getChangeColor = (change) => {
                if (change > 0) return '#22c55e';
                if (change < 0) return '#ef4444';
                return '#94a3b8';
            };
            
            const formatChange = (change) => {
                return (change > 0 ? '+' : '') + change.toFixed(2) + '%';
            };
            
            // Special handling for central bank rates with history
            if ((symbol === 'FED RATE' || symbol === 'BOE RATE' || symbol === 'ECB RATE') && data.history) {
                return `
                    <div class="ticker-item" style="display: inline-flex; align-items: center; gap: 8px; margin: 0 12px;">
                        <span class="ticker-symbol" style="color: #dbeafe; font-weight: 600;">${symbol}:</span>
                        <span class="ticker-value" style="color: #fff; font-weight: 500;">${formatValue(data.value)}</span>
                        <span style="color: #64748b; font-size: 0.65rem; margin-left: 8px;">History:</span>
                        ${data.history.map((rate, i) => `
                            <span style="color: ${i === data.history.length - 1 ? '#fbbf24' : '#94a3b8'}; font-size: 0.75rem; font-weight: ${i === data.history.length - 1 ? '600' : '400'};">
                                ${rate.toFixed(2)}%
                            </span>
                        `).join('')}
                    </div>
                    <span class="ticker-separator" style="color: #475569; margin: 0 8px;">●</span>
                `;
            }
            
            // Regular ticker item
            return `
                <div class="ticker-item" style="display: inline-flex; align-items: center; gap: 8px; margin: 0 12px;">
                    <span class="ticker-symbol" style="color: #dbeafe; font-weight: 600;">${symbol}:</span>
                    <span class="ticker-value" style="color: #fff; font-weight: 500;">${formatValue(data.value)}</span>
                    <span style="color: #64748b; font-size: 0.7rem; margin-left: 4px;">24h</span>
                    <span style="color: ${getChangeColor(data.change24h)}; font-size: 0.8rem; font-weight: 500;">${formatChange(data.change24h)}</span>
                    <span style="color: #64748b; font-size: 0.7rem;">7d</span>
                    <span style="color: ${getChangeColor(data.change7d)}; font-size: 0.8rem; font-weight: 500;">${formatChange(data.change7d)}</span>
                    <span style="color: #64748b; font-size: 0.7rem;">30d</span>
                    <span style="color: ${getChangeColor(data.change30d)}; font-size: 0.8rem; font-weight: 500;">${formatChange(data.change30d)}</span>
                </div>
                <span class="ticker-separator" style="color: #475569; margin: 0 8px;">●</span>
            `;
        }

        // Function to update ticker content without reinitializing
        function updateTickerContent() {
            const ticker = document.getElementById('marketTicker');
            if (!ticker) return;
            
            let content = '';
            
            // Build one complete set of ticker content
            function buildTickerContent() {
                let singleSet = '';
                
                // Bonds Section
                singleSet += '<span class="ticker-section-header">BONDS</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['US 10Y', 'UK 10Y', 'DE 10Y', 'US 5Y', 'US 2Y'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Central Banks
                singleSet += '<span class="ticker-section-header">CENTRAL BANKS</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['FED RATE', 'BOE RATE', 'ECB RATE'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Reference Rates
                singleSet += '<span class="ticker-section-header">REFERENCE RATES</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['SOFR', 'SONIA', 'ESTR'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Credit Spreads
                singleSet += '<span class="ticker-section-header">SECURITISATION</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['IG SPREAD', 'HY SPREAD', 'CMBS AAA', 'RMBS AAA', 'CLO AAA'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // FX
                singleSet += '<span class="ticker-section-header">FX</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['GBP/USD', 'EUR/USD', 'USD/JPY', 'EUR/GBP'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                // Commodities
                singleSet += '<span class="ticker-section-header">COMMODITIES</span>';
                singleSet += '<span class="ticker-separator">●</span>';
                ['GOLD', 'SILVER', 'OIL'].forEach(key => {
                    const data = marketData[key];
                    if (data) singleSet += createTickerItem(key, data);
                });
                
                return singleSet;
            }
            
            // Create three copies for seamless loop
            const singleContent = buildTickerContent();
            ticker.innerHTML = singleContent + singleContent + singleContent;
        }
        
        // Initialize ticker with live data
        // Ensure ticker is created after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                createTicker();
                fetchLiveMarketData();
            });
        } else {
            // DOM is already loaded
            createTicker();
            fetchLiveMarketData();
        }
        
        // Update market data every 30 seconds
        setInterval(fetchLiveMarketData, 30000);
        
        // Fix checkbox clicking functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Make checkbox divs fully clickable
            const checkboxDivs = document.querySelectorAll('.remember-checkbox');
            checkboxDivs.forEach(function(checkboxDiv) {
                // Add click handler to the checkbox container
                checkboxDiv.style.cursor = 'pointer';
                checkboxDiv.addEventListener('click', function(e) {
                    // Find the checkbox input inside this div
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    if (checkbox && e.target !== checkbox) {
                        // Toggle checkbox if clicking the div or checkmark icon (not the input itself)
                        checkbox.checked = !checkbox.checked;
                        // Trigger change event for any listeners
                        checkbox.dispatchEvent(new Event('change', { bubbles: true }));
                        e.preventDefault();
                    }
                });
            });
        });
        
        // Update market status
        function updateMarketStatus() {
            const now = new Date();
            const day = now.getUTCDay();
            const hour = now.getUTCHours();
            const minute = now.getUTCMinutes();
            const time = hour + minute / 60;
            
            let marketsOpen = [];
            let nextOpen = null;
            let allClosed = true;
            
            // Check UK market (8:00 - 16:30 GMT, Mon-Fri)
            const ukOpen = day >= 1 && day <= 5 && time >= 8 && time < 16.5;
            if (ukOpen) {
                marketsOpen.push('London');
                allClosed = false;
            }
            
            // Check US market (14:30 - 21:00 GMT, Mon-Fri)
            const usOpen = day >= 1 && day <= 5 && time >= 14.5 && time < 21;
            if (usOpen) {
                marketsOpen.push('New York');
                allClosed = false;
            }
            
            // Check EU market (8:00 - 16:30 CET = 7:00 - 15:30 GMT, Mon-Fri)
            const euOpen = day >= 1 && day <= 5 && time >= 7 && time < 15.5;
            if (euOpen) {
                marketsOpen.push('Frankfurt');
                allClosed = false;
            }
            
            const statusIndicator = document.getElementById('marketStatusIndicator');
            const statusText = document.getElementById('marketStatusText');
            
            if (statusIndicator && statusText) {
                if (allClosed) {
                    // Markets closed - red pulse
                    statusIndicator.style.background = '#ef4444';
                    statusIndicator.style.animation = 'pulse 2s infinite';
                    
                    // Calculate next open
                    if (day === 0 || day === 6 || (day === 5 && time >= 21)) {
                        // Weekend or Friday after close
                        nextOpen = 'Monday 07:00 GMT (Frankfurt)';
                    } else if (time < 7) {
                        nextOpen = 'Today 07:00 GMT (Frankfurt)';
                    } else if (time < 8) {
                        nextOpen = 'Today 08:00 GMT (London)';
                    } else if (time < 14.5) {
                        nextOpen = 'Today 14:30 GMT (New York)';
                    } else {
                        nextOpen = 'Tomorrow 07:00 GMT (Frankfurt)';
                    }
                    
                    statusText.textContent = `Markets Closed - Next Open: ${nextOpen}`;
                } else {
                    // Markets open - green pulse
                    statusIndicator.style.background = '#22c55e';
                    statusIndicator.style.animation = 'pulse 2s infinite';
                    statusText.textContent = `Markets Open: ${marketsOpen.join(', ')}`;
                }
            }
        }
        
        // Market insights rotation
        const marketInsights = [
            "CLO issuance reaches record levels in Q4 as spreads tighten amid strong investor demand. AAA tranches trading at historical lows with robust coverage ratios.",
            "European ABS markets show resilience as ECB maintains supportive stance. Prime RMBS spreads compress further with strong bid from institutional investors.",
            "Credit markets rally as inflation data surprises to the downside. Investment grade spreads tighten 15bps week-over-week with financials outperforming.",
            "Structured credit sees increased allocation from pension funds seeking yield. Mezzanine tranches experience strongest demand in two years.",
            "Bank capital issuance accelerates ahead of year-end. AT1 bonds find strong support from Asian investors despite regulatory concerns.",
            "Securitization pipeline builds with £2.5bn of UK RMBS expected before month-end. Cover pool quality remains strong with low LTV ratios.",
            "High yield market stabilizes after recent volatility. European HY spreads trade 50bps tighter as default expectations moderate.",
            "Commercial real estate CLOs gain traction as office sector shows signs of bottoming. Senior tranches remain well-bid despite sector headwinds.",
            "Sterling credit outperforms as BoE signals pause in rate cycle. UK corporates see strongest foreign demand since 2021.",
            "Synthetic securitization volumes surge as banks optimize capital. Significant risk transfer deals dominate issuance calendar."
        ];
        
        function loadRandomInsight() {
            const insight = marketInsights[Math.floor(Math.random() * marketInsights.length)];
            const insightElement = document.getElementById('marketInsight');
            if (insightElement) {
                insightElement.textContent = insight;
            }
        }
        
        // Update securitization metrics from ticker data
        function updateMarketCards() {
            // Pull data from the marketData object
            const aaaData = marketData['CLO AAA'];  // Fixed: was 'AAA CLO', should be 'CLO AAA'
            const igData = marketData['IG SPREAD'];
            const hyData = marketData['HY SPREAD'];
            
            if (aaaData) {
                const aaaValue = document.getElementById('aaaValue');
                if (aaaValue) aaaValue.textContent = aaaData.value.toFixed(2) + '%';
                const aaaChange = document.getElementById('aaaChange');
                if (aaaChange) {
                    aaaChange.textContent = (aaaData.change24h > 0 ? '+' : '') + aaaData.change24h.toFixed(2) + '%';
                    aaaChange.className = 'ticker-change ' + (aaaData.change24h >= 0 ? 'positive' : 'negative');
                }
            }
            
            if (igData) {
                const igValue = document.getElementById('igValue');
                if (igValue) igValue.textContent = igData.value.toFixed(2) + '%';
                const igChange = document.getElementById('igChange');
                if (igChange) {
                    igChange.textContent = (igData.change24h > 0 ? '+' : '') + igData.change24h.toFixed(2) + '%';
                    igChange.className = 'ticker-change ' + (igData.change24h >= 0 ? 'positive' : 'negative');
                }
            }
            
            if (hyData) {
                const hyValue = document.getElementById('hyValue');
                if (hyValue) hyValue.textContent = hyData.value.toFixed(2) + '%';
                const hyChange = document.getElementById('hyChange');
                if (hyChange) {
                    hyChange.textContent = (hyData.change24h > 0 ? '+' : '') + hyData.change24h.toFixed(2) + '%';
                    hyChange.className = 'ticker-change ' + (hyData.change24h >= 0 ? 'positive' : 'negative');
                }
            }
        }
        
        // Initialize on page load
        updateMarketStatus();
        loadRandomInsight();
        updateMarketCards();
        
        // Update market status every minute
        setInterval(updateMarketStatus, 60000);
        
        // Update market cards when data changes
        setInterval(updateMarketCards, 5000);

        // Password field visual feedback
        const passwordInput = document.getElementById('passwordInput');
        const passwordDots = document.getElementById('passwordDots');
        
        if (passwordInput && passwordDots) {
            passwordInput.addEventListener('input', function() {
                const length = this.value.length;
                passwordDots.textContent = '•'.repeat(Math.min(length, 12));
            });
        }

        // Handle login submission
        function handleLogin(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Check if remember me is checked
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Send to backend
            fetch('/auth', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Save credentials if remember me is checked and login successful
                    if (rememberMe) {
                        const email = document.getElementById('loginEmail').value;
                        const password = document.getElementById('passwordInput').value;
                        
                        // Save credentials with 24-hour expiration
                        const now = new Date().getTime();
                        const expirationTime = now + (24 * 60 * 60 * 1000); // 24 hours from now
                        
                        // Create secure credential object
                        const credentials = {
                            email: email,
                            password: btoa(password), // Basic encoding for storage
                            expiration: expirationTime,
                            savedAt: now
                        };
                        
                        // Save to localStorage
                        localStorage.setItem('rememberedCredentials', JSON.stringify(credentials));
                        localStorage.setItem('rememberMe', 'true');
                        
                        console.log('Credentials saved for 24 hours');
                    } else {
                        // Clear saved credentials if not remembering
                        localStorage.removeItem('rememberedCredentials');
                        localStorage.removeItem('rememberMe');
                    }
                    
                    window.location.href = data.redirect;
                } else {
                    alert(data.message || 'Invalid credentials');
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                alert('An error occurred. Please try again.');
            });
        }
        
        // Load saved credentials on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Check if we have saved credentials
            const savedCredentials = localStorage.getItem('rememberedCredentials');
            const rememberMe = localStorage.getItem('rememberMe') === 'true';
            
            if (savedCredentials && rememberMe) {
                try {
                    const credentials = JSON.parse(savedCredentials);
                    const now = new Date().getTime();
                    
                    // Check if credentials have expired (24 hours)
                    if (credentials.expiration && now < credentials.expiration) {
                        // Credentials are still valid
                        const emailInput = document.getElementById('loginEmail');
                        const passwordInput = document.getElementById('passwordInput');
                        const rememberCheckbox = document.getElementById('rememberMe');
                        
                        if (emailInput && passwordInput) {
                            emailInput.value = credentials.email;
                            passwordInput.value = atob(credentials.password); // Decode the password
                            
                            // Update password dots display
                            const passwordDots = document.getElementById('passwordDots');
                            if (passwordDots) {
                                passwordDots.textContent = '•'.repeat(Math.min(passwordInput.value.length, 12));
                            }
                        }
                        
                        if (rememberCheckbox) {
                            rememberCheckbox.checked = true;
                        }
                        
                        // Calculate time remaining
                        const hoursRemaining = Math.floor((credentials.expiration - now) / (1000 * 60 * 60));
                        const minutesRemaining = Math.floor(((credentials.expiration - now) % (1000 * 60 * 60)) / (1000 * 60));
                        
                        // Show a subtle notification
                        console.log(`Credentials loaded (expires in ${hoursRemaining}h ${minutesRemaining}m)`);
                        
                        // Add auto-login option with a delay
                        setTimeout(function() {
                            // Create auto-login notification
                            const autoLoginDiv = document.createElement('div');
                            autoLoginDiv.style.cssText = `
                                position: fixed;
                                top: 20px;
                                right: 20px;
                                background: rgba(34, 197, 94, 0.1);
                                border: 1px solid #22c55e;
                                color: #22c55e;
                                padding: 12px 20px;
                                border-radius: 8px;
                                font-size: 14px;
                                z-index: 10000;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                animation: slideIn 0.3s ease;
                            `;
                            autoLoginDiv.innerHTML = `
                                <i class="fas fa-check-circle"></i>
                                Credentials loaded (valid for ${hoursRemaining}h ${minutesRemaining}m)
                            `;
                            document.body.appendChild(autoLoginDiv);
                            
                            // Remove notification after 3 seconds
                            setTimeout(() => autoLoginDiv.remove(), 3000);
                        }, 500);
                        
                    } else {
                        // Credentials have expired, clean up
                        localStorage.removeItem('rememberedCredentials');
                        localStorage.removeItem('rememberMe');
                        console.log('Saved credentials expired and have been removed');
                    }
                } catch (error) {
                    console.error('Error loading saved credentials:', error);
                    // Clean up corrupted data
                    localStorage.removeItem('rememberedCredentials');
                    localStorage.removeItem('rememberMe');
                }
            }
            
            // Clean up old format credentials if they exist
            if (localStorage.getItem('savedEmail') || localStorage.getItem('savedPassword')) {
                localStorage.removeItem('savedEmail');
                localStorage.removeItem('savedPassword');
            }
        });

        // Handle registration submission
        function handleRegistration(event) {
            console.log('Registration form submitted!');
            event.preventDefault();
            
            // Check if terms checkbox is checked
            const termsCheckbox = document.getElementById('termsCheckbox');
            if (!termsCheckbox.checked) {
                showStyledAlert('Please agree to the terms of service and privacy policy to continue.', 'error');
                termsCheckbox.focus();
                return false;
            }
            
            // Get form and button
            const form = event.target;
            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            
            // Disable submit button and show loading state
            submitButton.disabled = true;
            submitButton.textContent = 'Processing...';
            submitButton.style.opacity = '0.7';
            
            // Submit the form to backend
            const formData = new FormData(form);
            
            fetch('/register', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Redirect to the new registration-submitted page
                    if (data.redirect) {
                        window.location.href = data.redirect;
                    } else {
                        // Fallback to showing awaiting verification
                        showAwaitingVerification(formData.get('email'));
                    }
                } else {
                    // Re-enable button on error
                    submitButton.disabled = false;
                    submitButton.textContent = originalText;
                    submitButton.style.opacity = '1';
                    showStyledAlert(data.message || 'Registration failed. Please try again.', 'error');
                }
            })
            .catch(error => {
                console.error('Registration error:', error);
                // Re-enable button on error
                submitButton.disabled = false;
                submitButton.textContent = originalText;
                submitButton.style.opacity = '1';
                showStyledAlert('An error occurred. Please try again.', 'error');
            });
            
            return false;
        }
        
        function showAwaitingVerification(email) {
            // Replace the entire login card with awaiting verification screen
            const loginCard = document.querySelector('.login-card');
            if (!loginCard) {
                console.error('Login card not found');
                showStyledAlert('Registration successful! Check your email for verification.', 'success');
                return;
            }
            
            // Set 10-minute countdown (600 seconds)
            let timeRemaining = 600;
            
            loginCard.innerHTML = `
                <div class="verification-screen" style="text-align: center; padding: 3rem;">
                    <div style="width: 100px; height: 100px; margin: 0 auto 2rem; border-radius: 50%; background: linear-gradient(135deg, rgba(96, 165, 250, 0.2) 0%, rgba(96, 165, 250, 0.1) 100%); display: flex; align-items: center; justify-content: center;">
                        <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2">
                            <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
                        </svg>
                    </div>
                    
                    <h2 style="font-family: var(--font-display); font-size: 2rem; font-weight: 700; color: var(--pure-white); margin-bottom: 1rem;">Verify Your Email</h2>
                    
                    <div style="background: rgba(239, 68, 68, 0.1); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: 10px; padding: 1.5rem; margin: 2rem 0;">
                        <div style="color: #ef4444; font-size: 1rem; margin-bottom: 0.75rem; font-weight: 600;">
                            ⚠️ Time Remaining to Verify
                        </div>
                        <div id="verificationCountdown" style="font-size: 2.5rem; font-weight: 700; color: #ef4444; font-family: monospace;">
                            10:00
                        </div>
                        <div style="color: #fbbf24; font-size: 0.875rem; margin-top: 0.75rem;">
                            Your registration will be cancelled if not verified in time
                        </div>
                    </div>
                    
                    <p style="color: var(--silver-light); font-size: 1.1rem; line-height: 1.6; margin-bottom: 2rem;">
                        We've sent a verification email to:
                    </p>
                    
                    <div style="background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 10px; padding: 1rem; margin: 2rem 0;">
                        <div style="color: var(--silver-light); font-size: 0.875rem; margin-bottom: 0.5rem;">Registered Email</div>
                        <div style="color: var(--platinum-gold); font-size: 1.1rem; font-weight: 600;">${email}</div>
                    </div>
                    
                    <div style="background: rgba(44, 49, 55, 0.5); border-radius: 15px; padding: 2rem; margin: 2rem 0; text-align: left;">
                        <div style="display: flex; align-items: flex-start; margin-bottom: 1.5rem;">
                            <div style="background: linear-gradient(135deg, var(--platinum-gold) 0%, #3b82f6 100%); color: var(--pure-white); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 1rem; flex-shrink: 0;">1</div>
                            <div>
                                <div style="color: var(--pure-white); font-weight: 600; margin-bottom: 0.25rem;">Verify Your Email</div>
                                <div style="color: var(--silver-light); font-size: 0.9rem;">Click the verification link in the email we sent you</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: flex-start; margin-bottom: 1.5rem;">
                            <div style="background: linear-gradient(135deg, var(--platinum-gold) 0%, #3b82f6 100%); color: var(--pure-white); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 1rem; flex-shrink: 0;">2</div>
                            <div>
                                <div style="color: var(--pure-white); font-weight: 600; margin-bottom: 0.25rem;">Admin Review</div>
                                <div style="color: var(--silver-light); font-size: 0.9rem;">Your application will be reviewed within 24 hours</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: flex-start;">
                            <div style="background: linear-gradient(135deg, var(--platinum-gold) 0%, #3b82f6 100%); color: var(--pure-white); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 1rem; flex-shrink: 0;">3</div>
                            <div>
                                <div style="color: var(--pure-white); font-weight: 600; margin-bottom: 0.25rem;">Access Granted</div>
                                <div style="color: var(--silver-light); font-size: 0.9rem;">Once approved, you'll receive your login credentials</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 2rem 0; padding: 1rem; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px;">
                        <p style="color: #22c55e; font-size: 0.9rem;">
                            <strong>Note:</strong> Please check your spam folder if you don't see the email within a few minutes.
                        </p>
                    </div>
                    
                    <button onclick="checkVerificationStatus()" style="background: transparent; color: var(--platinum-gold); border: 2px solid var(--platinum-gold); padding: 12px 30px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                        Check Verification Status
                    </button>
                </div>
            `;
            
            // Start countdown timer
            const countdownInterval = setInterval(() => {
                timeRemaining--;
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                const countdownElement = document.getElementById('verificationCountdown');
                if (countdownElement) {
                    countdownElement.textContent = display;
                    
                    // Change color as time runs out
                    if (timeRemaining <= 120) { // Last 2 minutes
                        countdownElement.style.color = '#dc2626'; // Darker red
                    } else if (timeRemaining <= 300) { // Last 5 minutes
                        countdownElement.style.color = '#ef4444'; // Red
                    }
                }
                
                // When timer expires
                if (timeRemaining <= 0) {
                    clearInterval(countdownInterval);
                    loginCard.innerHTML = `
                        <div class="verification-screen" style="text-align: center; padding: 3rem;">
                            <div style="width: 100px; height: 100px; margin: 0 auto 2rem; border-radius: 50%; background: rgba(239, 68, 68, 0.2); display: flex; align-items: center; justify-content: center;">
                                <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="15" y1="9" x2="9" y2="15"/>
                                    <line x1="9" y1="9" x2="15" y2="15"/>
                                </svg>
                            </div>
                            
                            <h2 style="font-family: var(--font-display); font-size: 2rem; font-weight: 700; color: #ef4444; margin-bottom: 1rem;">Registration Expired</h2>
                            
                            <p style="color: var(--silver-light); font-size: 1.1rem; line-height: 1.6; margin-bottom: 2rem;">
                                Your registration has expired because the email was not verified within 10 minutes.
                            </p>
                            
                            <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 10px; padding: 1rem; margin: 2rem 0;">
                                <div style="color: #ef4444; font-size: 0.9rem;">
                                    The registration for <strong>${email}</strong> has been cancelled.
                                </div>
                            </div>
                            
                            <button onclick="location.reload()" style="background: linear-gradient(135deg, var(--platinum-gold) 0%, #3b82f6 100%); color: var(--pure-white); border: none; padding: 12px 30px; border-radius: 10px; font-weight: 600; cursor: pointer; margin-top: 1rem;">
                                Try Again
                            </button>
                        </div>
                    `;
                    
                    // Notify backend that registration expired
                    fetch('/registration-expired', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: email })
                    });
                }
            }, 1000);
            
            // Start checking verification status automatically
            startVerificationCheck();
        }
        
        function showStyledAlert(message, type = 'info') {
            // Create a styled alert instead of browser popup
            const alertDiv = document.createElement('div');
            alertDiv.className = 'styled-alert';
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                max-width: 400px;
                padding: 1.5rem;
                background: ${type === 'error' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(96, 165, 250, 0.1)'};
                border: 1px solid ${type === 'error' ? 'rgba(239, 68, 68, 0.3)' : 'rgba(96, 165, 250, 0.3)'};
                border-radius: 10px;
                color: ${type === 'error' ? '#ef4444' : '#60a5fa'};
                font-size: 0.95rem;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            alertDiv.textContent = message;
            
            document.body.appendChild(alertDiv);
            
            // Remove after 5 seconds
            setTimeout(() => {
                alertDiv.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => alertDiv.remove(), 300);
            }, 5000);
        }
        
        let verificationCheckInterval;
        
        function startVerificationCheck() {
            // Check every 5 seconds for verification status
            verificationCheckInterval = setInterval(checkVerificationStatus, 5000);
            
            // Stop checking after 5 minutes
            setTimeout(() => {
                if (verificationCheckInterval) {
                    clearInterval(verificationCheckInterval);
                }
            }, 300000);
        }
        
        function checkVerificationStatus() {
            fetch('/check-verification-status')
                .then(response => response.json())
                .then(data => {
                    if (data.verified) {
                        // User is verified, show login form only
                        clearInterval(verificationCheckInterval);
                        showLoginOnly();
                    }
                })
                .catch(error => console.log('Verification check failed:', error));
        }
        
        function showLoginOnly() {
            // Replace with login form only after verification
            const authContainer = document.querySelector('.auth-container') || document.querySelector('.verification-screen').parentElement;
            authContainer.innerHTML = `
                <div class="login-header">
                    <div class="login-badge">Email Verified ✓</div>
                    <h2 class="login-title">Welcome Back</h2>
                    <p class="login-subtitle">Your email has been verified. Please login to continue.</p>
                </div>
                
                <form class="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" name="email" required placeholder="Enter your email">
                        <div class="verified-email">Email verified</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" name="password" required placeholder="Enter your password">
                        <p class="password-help">Your temporary password was sent to your email</p>
                    </div>
                    
                    <div class="remember-group" style="display: flex; align-items: center; gap: var(--space-3);">
                        <label class="remember-checkbox">
                            <input type="checkbox" name="remember">
                            <span class="checkbox-icon">✓</span>
                        </label>
                        <label class="remember-label">Remember me for 30 days</label>
                    </div>
                    
                    <button type="submit" class="submit-button">
                        Access Dashboard
                    </button>
                </form>
            `;
        }
        
        // Tab switching
        function switchTab(tab) {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const tabButtons = document.querySelectorAll('.tab-button');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                tabButtons[0].classList.add('active');
                tabButtons[1].classList.remove('active');
            } else {
                loginTab.classList.remove('active');
                registerTab.classList.add('active');
                tabButtons[0].classList.remove('active');
                tabButtons[1].classList.add('active');
            }
            
            // Scroll to top to show the login/register form
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Open Companies House in popup window
        function openCompaniesHouseSearch() {
            const companyName = document.getElementById('companyName').value.trim();
            
            if (companyName.length < 2) {
                alert('Please enter at least 2 characters to search');
                return;
            }
            
            // Open Companies House in a small popup window
            const searchUrl = `https://find-and-update.company-information.service.gov.uk/search/companies?q=${encodeURIComponent(companyName)}`;
            
            // Calculate center position
            const width = 800;
            const height = 600;
            const left = (window.screen.width - width) / 2;
            const top = (window.screen.height - height) / 2;
            
            // Open popup window
            window.open(
                searchUrl, 
                'CompaniesHouseSearch',
                `width=${width},height=${height},left=${left},top=${top},toolbar=no,menubar=no,scrollbars=yes,resizable=yes`
            );
        }

        // Update country code dropdown display
        function updateCountryDisplay(select) {
            // Keep only the dialing code visible when selected
            const selectedOption = select.options[select.selectedIndex];
            selectedOption.text = selectedOption.value;
        }
        
        // Show country names when dropdown is focused/opened
        document.getElementById('countryCode').addEventListener('focus', function() {
            const options = this.options;
            for (let i = 0; i < options.length; i++) {
                const country = options[i].getAttribute('data-country');
                options[i].text = `${options[i].value} ${country}`;
            }
        });
        
        // Show only codes when dropdown loses focus
        document.getElementById('countryCode').addEventListener('blur', function() {
            const options = this.options;
            for (let i = 0; i < options.length; i++) {
                options[i].text = options[i].value;
            }
        });
        
        // Initialize with just codes visible
        window.addEventListener('DOMContentLoaded', function() {
            const countrySelect = document.getElementById('countryCode');
            if (countrySelect) {
                const options = countrySelect.options;
                for (let i = 0; i < options.length; i++) {
                    options[i].text = options[i].value;
                }
            }
        });
        
        // Auto-search as user types
        document.getElementById('companyName').addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            const value = e.target.value;
            
            if (value.length >= 3) {
                searchTimeout = setTimeout(() => {
                    searchCompaniesHouse(true);
                }, 500); // Wait 500ms after user stops typing
            } else {
                document.getElementById('companyResults').style.display = 'none';
            }
        });
        
        // Registration form submission is handled by handleRegistration function
        // Remove duplicate event listener
        /*
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Combine phone number parts
            const countryCode = document.getElementById('countryCode').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const fullPhone = `${countryCode} ${phoneNumber}`;
            
            // Get form data
            const formData = {
                fullName: e.target.fullname.value,
                email: e.target.email.value,
                phone: fullPhone,
                company: e.target.company.value,
                address: e.target.address.value,
                companyNumber: e.target.company_number.value
            };
            
            console.log('Registration data:', formData);
            alert('Registration request submitted. You will receive confirmation within 24 hours.');
        });
        */

        // View market preview
        function viewMarketPreview() {
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            // Create market intelligence preview overlay
            const previewOverlay = document.createElement('div');
            previewOverlay.id = 'marketPreviewOverlay';
            previewOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #0a0e1a;
                z-index: 10000;
                overflow-y: auto;
                overflow-x: hidden;
                animation: fadeIn 0.5s ease;
            `;
            
            previewOverlay.innerHTML = `
                <div style="position: relative; min-height: 100vh;">
                    <!-- Close Button -->
                    <button onclick="closeMarketPreview()" style="position: fixed; top: 20px; right: 20px; background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; color: #ef4444; padding: 10px 20px; border-radius: 8px; cursor: pointer; z-index: 10001; font-weight: 600;">
                        ✕ Close Preview
                    </button>
                    
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 3rem 2rem; text-align: center; border-bottom: 2px solid var(--platinum-gold);">
                        <h1 style="font-family: var(--font-display); font-size: 3rem; font-weight: 700; color: var(--pure-white); margin-bottom: 1rem;">
                            Market Intelligence Platform
                        </h1>
                        <p style="color: var(--platinum-gold); font-size: 1.2rem;">
                            Institutional-Grade Securitization Analytics
                        </p>
                    </div>
                    
                    <!-- Market Overview Grid -->
                    <div style="padding: 3rem 2rem; max-width: 1400px; margin: 0 auto;">
                        <h2 style="color: var(--pure-white); font-size: 2rem; margin-bottom: 2rem;">Real-Time Market Overview</h2>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 3rem;">
                            <!-- CLO Market Card -->
                            <div style="background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 12px; padding: 1.5rem;">
                                <h3 style="color: #60a5fa; margin-bottom: 1rem;">CLO Market</h3>
                                <div style="color: var(--pure-white); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">€145.3B</div>
                                <div style="color: #22c55e; font-size: 0.9rem;">+12.4% YTD Issuance</div>
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(96, 165, 250, 0.2);">
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">AAA Spread: 175bps</div>
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">New Issue Pipeline: €8.2B</div>
                                </div>
                            </div>
                            
                            <!-- ABS Market Card -->
                            <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 1.5rem;">
                                <h3 style="color: #22c55e; margin-bottom: 1rem;">ABS Market</h3>
                                <div style="color: var(--pure-white); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">£62.8B</div>
                                <div style="color: #22c55e; font-size: 0.9rem;">+8.7% QoQ Growth</div>
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(34, 197, 94, 0.2);">
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">Auto ABS: £23.4B</div>
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">Card ABS: £15.6B</div>
                                </div>
                            </div>
                            
                            <!-- RMBS Market Card -->
                            <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 1.5rem;">
                                <h3 style="color: #fbbf24; margin-bottom: 1rem;">RMBS Market</h3>
                                <div style="color: var(--pure-white); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">£187.4B</div>
                                <div style="color: #ef4444; font-size: 0.9rem;">-3.2% MoM</div>
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(251, 191, 36, 0.2);">
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">Prime RMBS: £142.3B</div>
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">BTL RMBS: £45.1B</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Analytics Section -->
                        <h2 style="color: var(--pure-white); font-size: 2rem; margin-bottom: 2rem;">Detailed Analytics</h2>
                        
                        <div style="background: rgba(30, 41, 59, 0.5); border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
                            <h3 style="color: #60a5fa; margin-bottom: 1.5rem;">Spread Analysis</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">IG Corps</div>
                                    <div style="color: var(--pure-white); font-size: 1.5rem; font-weight: bold;">145bps</div>
                                    <div style="color: #22c55e; font-size: 0.8rem;">-5bps today</div>
                                </div>
                                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">HY Corps</div>
                                    <div style="color: var(--pure-white); font-size: 1.5rem; font-weight: bold;">425bps</div>
                                    <div style="color: #ef4444; font-size: 0.8rem;">+8bps today</div>
                                </div>
                                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">CLO BBB</div>
                                    <div style="color: var(--pure-white); font-size: 1.5rem; font-weight: bold;">385bps</div>
                                    <div style="color: #22c55e; font-size: 0.8rem;">-12bps today</div>
                                </div>
                                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                                    <div style="color: var(--silver-light); font-size: 0.85rem;">CMBS AAA</div>
                                    <div style="color: var(--pure-white); font-size: 1.5rem; font-weight: bold;">165bps</div>
                                    <div style="color: #fbbf24; font-size: 0.8rem;">Unchanged</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Performance Metrics -->
                        <div style="background: rgba(30, 41, 59, 0.5); border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
                            <h3 style="color: #22c55e; margin-bottom: 1.5rem;">Performance Metrics</h3>
                            <div style="color: var(--silver-light); line-height: 2;">
                                <div>• European CLO issuance up 45% YoY, driven by refinancing activity</div>
                                <div>• UK RMBS spreads tighten 20bps on BoE dovish pivot expectations</div>
                                <div>• Investment grade credit outperforms with 2.3% MTD total return</div>
                                <div>• Structured credit allocation increases to 12% of institutional portfolios</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fade Overlay -->
                    <div id="fadeOverlay" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; background: linear-gradient(to bottom, transparent, rgba(10, 14, 26, 0.95) 50%, #0a0e1a); pointer-events: none; opacity: 0; transition: opacity 0.5s ease;"></div>
                    
                    <!-- Login Prompt -->
                    <div id="loginPrompt" style="position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); background: rgba(30, 41, 59, 0.98); border: 2px solid var(--platinum-gold); border-radius: 12px; padding: 2rem 3rem; text-align: center; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; z-index: 10002;">
                        <h3 style="color: var(--platinum-gold); font-size: 1.5rem; margin-bottom: 1rem;">Access Full Intelligence</h3>
                        <p style="color: var(--silver-light); margin-bottom: 1.5rem;">Login to access real-time data, advanced analytics, and proprietary research</p>
                        <button onclick="closeMarketPreview(); showLoginOnly();" style="background: linear-gradient(135deg, var(--platinum-gold) 0%, #3b82f6 100%); color: var(--pure-white); border: none; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1.1rem;">
                            Login to Continue
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(previewOverlay);
            
            // Add scroll listener
            let hasTriggeredFade = false;
            previewOverlay.addEventListener('scroll', function() {
                if (!hasTriggeredFade && previewOverlay.scrollTop > 200) {
                    hasTriggeredFade = true;
                    document.getElementById('fadeOverlay').style.opacity = '1';
                    document.getElementById('loginPrompt').style.opacity = '1';
                    document.getElementById('loginPrompt').style.pointerEvents = 'auto';
                }
            });
        }
        
        function closeMarketPreview() {
            const overlay = document.getElementById('marketPreviewOverlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    overlay.remove();
                    // Restore body scroll
                    document.body.style.overflow = '';
                }, 300);
            }
        }

        // Cookie consent management
        function checkCookieConsent() {
            const cookieConsent = localStorage.getItem('cookieConsent');
            if (!cookieConsent) {
                // Show cookie popup after a short delay when page loads
                setTimeout(() => {
                    document.getElementById('cookiePopup').classList.add('show');
                }, 1000);
            }
        }

        function acceptAllCookies() {
            localStorage.setItem('cookieConsent', 'all');
            localStorage.setItem('cookieConsentDate', new Date().toISOString());
            document.getElementById('cookiePopup').classList.remove('show');
            // Enable all cookies
            console.log('All cookies accepted');
        }

        function acceptEssentialCookies() {
            localStorage.setItem('cookieConsent', 'essential');
            localStorage.setItem('cookieConsentDate', new Date().toISOString());
            document.getElementById('cookiePopup').classList.remove('show');
            // Enable only essential cookies
            console.log('Essential cookies only');
        }

        // Check cookie consent when page loads
        window.addEventListener('load', checkCookieConsent);

        // Removed duplicate ticker drag code - already handled in createTicker()

        // Copy email to clipboard
        function copyEmail() {
            const email = 'Support@AtlasNexus.co.uk';
            navigator.clipboard.writeText(email).then(() => {
                // Change button text temporarily
                const button = event.target;
                const originalText = button.innerText;
                button.innerText = 'Copied!';
                button.style.color = '#22c55e';
                button.style.borderColor = 'rgba(34, 197, 94, 0.3)';
                
                setTimeout(() => {
                    button.innerText = originalText;
                    button.style.color = 'var(--silver-mist)';
                    button.style.borderColor = 'rgba(96, 165, 250, 0.3)';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

    </script>

    <!-- Cookie Consent Popup -->
    <div id="cookiePopup" class="cookie-popup">
        <div class="cookie-content">
            <div class="cookie-text">
                <h3>Cookie Preferences</h3>
                <p>We use cookies to enhance your experience, analyse site traffic, and provide personalised content. 
                   You can choose to accept all cookies or only essential cookies. 
                   Learn more in our <a href="/privacy#cookies" target="_blank">Cookie Policy</a>.</p>
            </div>
            <div class="cookie-buttons">
                <button class="cookie-btn cookie-accept-essential" onclick="acceptEssentialCookies()">
                    Accept Essential Only
                </button>
                <button class="cookie-btn cookie-accept-all" onclick="acceptAllCookies()">
                    Accept All Cookies
                </button>
            </div>
        </div>
    </div>

</body>
</html>